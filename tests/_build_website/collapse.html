
<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Collapse Cell &ndash; Quantitative Economics</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="author" content="Quantitative Economics">
		<meta name="keywords" content="QuantEcon, Quantitative Economics, Economics, Sloan, Alfred P. Sloan Foundation, Tom J. Sargent, John Stachurski">
		<meta name="description" content="This website presents a series of lectures on quantitative economic modeling, designed and written by Thomas J. Sargent and John Stachurski.">
		<meta name="twitter:card" content="summary">
		<meta name="twitter:site" content="@quantecon">
		<meta name="twitter:title" content="Collapse Cell">
		<meta name="twitter:description" content="This website presents a series of lectures on quantitative economic modeling, designed and written by Thomas J. Sargent and John Stachurski.">
		<meta name="twitter:creator" content="@quantecon">
		<meta name="twitter:image" content="https://lectures.quantecon.org/_static/img/qeco-logo.png">
		<meta property="og:title" content="Collapse Cell" />
		<meta property="og:type" content="website" />
		<meta property="og:url" content="https://lectures.quantecon.org/py/collapse.html" />
		<meta property="og:image" content="https://lectures.quantecon.org/_static/img/qeco-logo.png" />
		<meta property="og:description" content="This website presents a series of lectures on quantitative economic modeling, designed and written by Thomas J. Sargent and John Stachurski." />
		<meta property="og:site_name" content="Quantitative Economics" />

        <link rel="stylesheet" href="/_static/css/basic.css">
        <link rel="stylesheet" href="/_static/css/qe.css?v=2.16">
        <link rel="stylesheet" href="https://assets.quantecon.org/css/qe-menubar.css">
        <link rel="icon" href="/_static/img/favicon.ico" type="image/x-icon" />

        <link href="https://fonts.googleapis.com/css?family=Droid+Serif|Source+Sans+Pro:400,700" rel="stylesheet">

    </head>


    <body class="py">


        <div class="qe-menubar">
        
            <p class="qe-menubar-logo"><a href="https://quantecon.org/" title="quantecon.org"><img src="https://assets.quantecon.org/img/qe-menubar-logo.svg" alt="QuantEcon"></a></p>
        
            <ul class="qe-menubar-nav">
                <li><a href="https://lectures.quantecon.org/" title="Lectures"><span>Lectures</span></a></li>
                <li><a href="https://quantecon.org/quantecon-py" title="QuantEcon.py"><span>QuantEcon.py</span></a></li>
                <li><a href="https://quantecon.org/quantecon-jl" title="QuantEcon.jl"><span>QuantEcon.jl</span></a></li>
                <li><a href="https://quantecon.org/notebooks" title="QuantEcon Notebook Library"><span>NB Library</span></a></li>
                <li><a href="http://notes.quantecon.org/" title="QE Notes"><span>QE Notes</span></a></li>
                <li><a href="http://cheatsheets.quantecon.org/" title="Cheatsheets"><span>Cheatsheets</span></a></li>
                <li><a href="http://blog.quantecon.org/" title="Blog"><span>Blog</span></a></li>
                <li><a href="http://discourse.quantecon.org/" title="Forum"><span>Forum</span></a></li>
                <li><a href="http://store.quantecon.org/" title="Store"><span class="show-for-sr">Store</span></a></li>
                <li><a href="https://github.com/QuantEcon/" title="Repository"><span class="show-for-sr">Repository</span></a></li>
                <li><a href="https://twitter.com/quantecon" title="Twitter"><span class="show-for-sr">Twitter</span></a></li>
            </ul>
            
        </div>

        <div class="wrapper">

	        <header class="header">

				<div class="container">

		        	<div class="branding">


			        	<p class="site-title"><a href="https://lectures.quantecon.org">Quantitative Economics with Python</a></p>


			        	<p class="visuallyhidden"><a href="#skip">Skip to content</a></p>

			        	<ul class="site-authors">

			        		<li><a href="http://www.tomsargent.com/">Thomas J. Sargent</a></li>
			        		<li><a href="http://johnstachurski.net/">John Stachurski</a></li>
			        	</ul>

		        	</div>

		        	<nav class="main-nav">

			        	<ul>
		        			<li class="section-home"><a href="/">Home</a></li>
		        			<li class="section-py"><a href="/py/">Python</a></li>
		        			<li class="section-jl"><a href="/jl/">Julia</a></li>
							<li><a href="#pdf-options" name="pdf-options" rel="leanModal">PDF</a></li>
			        	</ul>

					</nav>

		        	<div class="pdf-options" id="pdf-options">
		        		<a class="modal_close" href="#"><span class="icon icon-cross"></span></a>
		        		<h2>Download PDF</h2>
					<p>We are working to support a site-wide PDF but it is not yet available. You can download PDFs for individual lectures through the download badge on each lecture page.</p>
		        	</div>

		        	<div class="header-search"><gcse:searchbox-only></gcse:searchbox-only></div>

		        	<p id="combined_percentage" class="combined-coverage"><a href="/status.html"></a></p>

				</div>

	        </header>


			<div class="main">

				<div class="breadcrumbs clearfix">
					<ul>
						<li><a href="https://quantecon.org/">Org</a> •</li>
						<li><a href="https://lectures.quantecon.org">Lectures</a> &raquo;</li>
						<li><a href="https://lectures.quantecon.org/py/">Python </a> &raquo;</li>
				      	<li>Collapse Cell</li>
					</ul>
				</div>


				<div class="content">

					<div id="skip"></div>

				    <div class="document">



						<ul class="badges">
							<li><a href="https://colab.research.google.com/github/QuantEcon/lecture-py-notebooks/blob/master/collapse.ipynb"><img src="/_static/img/jupyter-notebook-run-FDD935.svg" id="notebook_run_badge"></a></li>
							<li><a href="/_downloads/ipynb/py/collapse.ipynb"><img src="/_static/img/jupyter-notebook-download-blue.svg" id="notebook_download_badge"></a></li>
							<li><a href="/_downloads/pdf/py/collapse.pdf"><img src="/_static/img/pdf-download-blue.svg" id="pdf_download_badge"></a></li>
							<li><a href="/status.html"><img src="https://img.shields.io/badge/Execution%20test-not%20available-lightgrey.svg" id="executability_status_badge"></a></li>
						</ul>

						<div class="how-to">
							<a href="#" class="toggle"><span class="icon icon-angle-double-down"></span>How to read this lecture...</a>
							<div class="how-to-content">
								<p>Code should execute sequentially if run in a Jupyter notebook</p>
								<ul>
									<li>See the <a href="/py/getting_started.html">set up page</a> to install Jupyter, Python and all necessary libraries</li>
									<li>Please direct feedback to <a href="mailto:contact@quantecon.org">contact@quantecon.org</a> or the <a href="http://discourse.quantecon.org/">discourse forum</a></li>
								</ul>
							</div>
						</div>



<div class="{} cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Collapse-Cell">Collapse Cell<a class="anchor-link" href="#Collapse-Cell">&#182;</a></h1><p>This is testing passthrough for code collapse that can be implemented
at the html theme level.</p>

</div>
</div>
</div>

<div class="collapse cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="k">import</span> <span class="n">root</span>
<span class="kn">from</span> <span class="nn">quantecon</span> <span class="k">import</span> <span class="n">MarkovChain</span>


<span class="k">class</span> <span class="nc">SequentialAllocation</span><span class="p">:</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Class that takes CESutility or BGPutility object as input returns</span>
<span class="sd">    planner&#39;s allocation as a function of the multiplier on the</span>
<span class="sd">    implementability constraint μ.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>

        <span class="c1"># Initialize from model object attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">β</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">π</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">β</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">π</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">G</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Θ</span> <span class="o">=</span> <span class="n">MarkovChain</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">π</span><span class="p">),</span> <span class="n">model</span><span class="o">.</span><span class="n">Θ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">S</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">π</span><span class="p">)</span>  <span class="c1"># Number of states</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>

        <span class="c1"># Find the first best allocation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_first_best</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">find_first_best</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Find the first best allocation</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
        <span class="n">S</span><span class="p">,</span> <span class="n">Θ</span><span class="p">,</span> <span class="n">G</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Θ</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span>
        <span class="n">Uc</span><span class="p">,</span> <span class="n">Un</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Uc</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Un</span>

        <span class="k">def</span> <span class="nf">res</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">z</span><span class="p">[:</span><span class="n">S</span><span class="p">]</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="n">S</span><span class="p">:]</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">Θ</span> <span class="o">*</span> <span class="n">Uc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">Un</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">Θ</span> <span class="o">*</span> <span class="n">n</span> <span class="o">-</span> <span class="n">c</span> <span class="o">-</span> <span class="n">G</span><span class="p">])</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">root</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">S</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Could not find first best&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cFB</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">[:</span><span class="n">S</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nFB</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">S</span><span class="p">:]</span>

        <span class="c1"># Multiplier on the resource constraint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ΞFB</span> <span class="o">=</span> <span class="n">Uc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cFB</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nFB</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zFB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">cFB</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nFB</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ΞFB</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">time1_allocation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">μ</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Computes optimal allocation for time t &gt;= 1 for a given μ</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
        <span class="n">S</span><span class="p">,</span> <span class="n">Θ</span><span class="p">,</span> <span class="n">G</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Θ</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span>
        <span class="n">Uc</span><span class="p">,</span> <span class="n">Ucc</span><span class="p">,</span> <span class="n">Un</span><span class="p">,</span> <span class="n">Unn</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Uc</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Ucc</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Un</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Unn</span>

        <span class="k">def</span> <span class="nf">FOC</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">z</span><span class="p">[:</span><span class="n">S</span><span class="p">]</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="n">S</span><span class="p">:</span><span class="mi">2</span> <span class="o">*</span> <span class="n">S</span><span class="p">]</span>
            <span class="n">Ξ</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">S</span><span class="p">:]</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">Uc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="n">μ</span> <span class="o">*</span> <span class="p">(</span><span class="n">Ucc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">c</span> <span class="o">+</span> <span class="n">Uc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span> <span class="o">-</span> <span class="n">Ξ</span><span class="p">,</span>          <span class="c1"># FOC of c</span>
                              <span class="n">Un</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="n">μ</span> <span class="o">*</span> <span class="p">(</span><span class="n">Unn</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="n">Un</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span> <span class="o">+</span> \
                              <span class="n">Θ</span> <span class="o">*</span> <span class="n">Ξ</span><span class="p">,</span>  <span class="c1"># FOC of n</span>
                              <span class="n">Θ</span> <span class="o">*</span> <span class="n">n</span> <span class="o">-</span> <span class="n">c</span> <span class="o">-</span> <span class="n">G</span><span class="p">])</span>

        <span class="c1"># Find the root of the first order condition</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">root</span><span class="p">(</span><span class="n">FOC</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zFB</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Could not find LS allocation.&#39;</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">x</span>
        <span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">Ξ</span> <span class="o">=</span> <span class="n">z</span><span class="p">[:</span><span class="n">S</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="n">S</span><span class="p">:</span><span class="mi">2</span> <span class="o">*</span> <span class="n">S</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">S</span><span class="p">:]</span>

        <span class="c1"># Compute x</span>
        <span class="n">I</span> <span class="o">=</span> <span class="n">Uc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">c</span> <span class="o">+</span> <span class="n">Un</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">S</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">β</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">π</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Ξ</span>

    <span class="k">def</span> <span class="nf">time0_allocation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">B_</span><span class="p">,</span> <span class="n">s_0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Finds the optimal allocation given initial government debt B_ and state s_0</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">model</span><span class="p">,</span> <span class="n">π</span><span class="p">,</span> <span class="n">Θ</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">β</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">π</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Θ</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">β</span>
        <span class="n">Uc</span><span class="p">,</span> <span class="n">Ucc</span><span class="p">,</span> <span class="n">Un</span><span class="p">,</span> <span class="n">Unn</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Uc</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Ucc</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Un</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Unn</span>

        <span class="c1"># First order conditions of planner&#39;s problem</span>
        <span class="k">def</span> <span class="nf">FOC</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
            <span class="n">μ</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">Ξ</span> <span class="o">=</span> <span class="n">z</span>
            <span class="n">xprime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time1_allocation</span><span class="p">(</span><span class="n">μ</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">Uc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">c</span> <span class="o">-</span> <span class="n">B_</span><span class="p">)</span> <span class="o">+</span> <span class="n">Un</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="n">β</span> <span class="o">*</span> <span class="n">π</span><span class="p">[</span><span class="n">s_0</span><span class="p">]</span> <span class="o">@</span> <span class="n">xprime</span><span class="p">,</span>
                              <span class="n">Uc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="n">μ</span> <span class="o">*</span> <span class="p">(</span><span class="n">Ucc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span>
                                               <span class="p">(</span><span class="n">c</span> <span class="o">-</span> <span class="n">B_</span><span class="p">)</span> <span class="o">+</span> <span class="n">Uc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span> <span class="o">-</span> <span class="n">Ξ</span><span class="p">,</span>
                              <span class="n">Un</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="n">μ</span> <span class="o">*</span> <span class="p">(</span><span class="n">Unn</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span>
                                               <span class="n">Un</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span> <span class="o">+</span> <span class="n">Θ</span><span class="p">[</span><span class="n">s_0</span><span class="p">]</span> <span class="o">*</span> <span class="n">Ξ</span><span class="p">,</span>
                              <span class="p">(</span><span class="n">Θ</span> <span class="o">*</span> <span class="n">n</span> <span class="o">-</span> <span class="n">c</span> <span class="o">-</span> <span class="n">G</span><span class="p">)[</span><span class="n">s_0</span><span class="p">]])</span>

        <span class="c1"># Find root</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">root</span><span class="p">(</span><span class="n">FOC</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cFB</span><span class="p">[</span><span class="n">s_0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nFB</span><span class="p">[</span><span class="n">s_0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ΞFB</span><span class="p">[</span><span class="n">s_0</span><span class="p">]]))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Could not find time 0 LS allocation.&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="n">x</span>

    <span class="k">def</span> <span class="nf">time1_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">μ</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Find the value associated with multiplier μ</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Ξ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time1_allocation</span><span class="p">(</span><span class="n">μ</span><span class="p">)</span>
        <span class="n">U</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">U</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">β</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">π</span><span class="p">,</span> <span class="n">U</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">V</span>

    <span class="k">def</span> <span class="nf">Τ</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Computes Τ given c, n</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
        <span class="n">Uc</span><span class="p">,</span> <span class="n">Un</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Uc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">model</span><span class="o">.</span><span class="n">Un</span><span class="p">(</span><span class="n">c</span><span class="p">,</span>  <span class="n">n</span><span class="p">)</span>

        <span class="k">return</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">Un</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Θ</span> <span class="o">*</span> <span class="n">Uc</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">simulate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">B_</span><span class="p">,</span> <span class="n">s_0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">sHist</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Simulates planners policies for T periods</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">model</span><span class="p">,</span> <span class="n">π</span><span class="p">,</span> <span class="n">β</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">π</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">β</span>
        <span class="n">Uc</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Uc</span>

        <span class="k">if</span> <span class="n">sHist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sHist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">s_0</span><span class="p">)</span>

        <span class="n">cHist</span><span class="p">,</span> <span class="n">nHist</span><span class="p">,</span> <span class="n">Bhist</span><span class="p">,</span> <span class="n">ΤHist</span><span class="p">,</span> <span class="n">μHist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="n">T</span><span class="p">))</span>
        <span class="n">RHist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Time 0</span>
        <span class="n">μ</span><span class="p">,</span> <span class="n">cHist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nHist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time0_allocation</span><span class="p">(</span><span class="n">B_</span><span class="p">,</span> <span class="n">s_0</span><span class="p">)</span>
        <span class="n">ΤHist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Τ</span><span class="p">(</span><span class="n">cHist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nHist</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="n">s_0</span><span class="p">]</span>
        <span class="n">Bhist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">B_</span>
        <span class="n">μHist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">μ</span>

        <span class="c1"># Time 1 onward</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
            <span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Ξ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time1_allocation</span><span class="p">(</span><span class="n">μ</span><span class="p">)</span>
            <span class="n">Τ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Τ</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
            <span class="n">u_c</span> <span class="o">=</span> <span class="n">Uc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">sHist</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
            <span class="n">Eu_c</span> <span class="o">=</span> <span class="n">π</span><span class="p">[</span><span class="n">sHist</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">@</span> <span class="n">u_c</span>
            <span class="n">cHist</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">nHist</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">Bhist</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">ΤHist</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">s</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="n">s</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">/</span> \
                <span class="n">u_c</span><span class="p">[</span><span class="n">s</span><span class="p">],</span> <span class="n">Τ</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
            <span class="n">RHist</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Uc</span><span class="p">(</span><span class="n">cHist</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">nHist</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">β</span> <span class="o">*</span> <span class="n">Eu_c</span><span class="p">)</span>
            <span class="n">μHist</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">μ</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">cHist</span><span class="p">,</span> <span class="n">nHist</span><span class="p">,</span> <span class="n">Bhist</span><span class="p">,</span> <span class="n">ΤHist</span><span class="p">,</span> <span class="n">sHist</span><span class="p">,</span> <span class="n">μHist</span><span class="p">,</span> <span class="n">RHist</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
 




				    </div>

				</div>

				<!-- topic-pager footer nav -->

			</div>

			<footer class="footer">

				<div class="container">

					<p><a rel="license" href="http://creativecommons.org/licenses/by-nd/4.0/"><img alt="Creative Commons License" src="https://i.creativecommons.org/l/by-nd/4.0/80x15.png" /></a></p>

					<p>This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nd/4.0/">Creative Commons Attribution-NoDerivatives 4.0 International License</a>.</p>

					<p>&copy; Copyright 2017, Thomas J. Sargent and John Stachurski. Created using <a href="http://www.sphinx-doc.org/">Sphinx</a>, hosted with <a href="https://aws.amazon.com/">AWS</a>.</p>

				</div>

			</footer>

        </div>

        <div class="page-tools">
	        <ul>
		        <li class="top"><a href="#top" title="Back to top"><span class="icon icon-chevron-up"></span></a></li>
		        <li><a href="http://twitter.com/intent/tweet?url=https%3A%2F%2Flectures.quantecon.org%2Fpy%2Fcollapse.html&via=QuantEcon&text=Covariance Stationary Processes" title="Share on Twitter" target="_blank"><span class="icon icon-twitter"></span></a></li>
		        <li><a href="https://www.linkedin.com/shareArticle?mini=true&url=https://lectures.quentecon.org%2Fpy%2Fcollapse.html&title=Covariance Stationary Processes&summary=This%20website%20presents%20a%20series%20of%20lectures%20on%20quantitative%20economic%20modeling,%20designed%20and%20written%20by%20Thomas%20J.%20Sargent%20and%20John%20Stachurski.&source=QuantEcon" title="Share on LinkedIn" target="_blank"><span class="icon icon-linkedin"></span></a></li>
		        <li><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A//lectures.quantecon.org%2Fpy%2Fcollapse.html" title="Share on Facebook" target="_blank"><span class="icon icon-facebook"></span></a></li>
		        <li><span class="title">Share page</span></li>
	        </ul>
        </div>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="/_static/js/vendor/jquery-1.11.0.min.js"><\/script>')</script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <script src="/_static/js/plugins.js"></script>
        <script src="/_static/js/qe.js?v=2.4"></script>

	    <script>
	      var DOCUMENTATION_OPTIONS = {
	        URL_ROOT:    '',
	        VERSION:     '2018-Aug-8',
	        COLLAPSE_INDEX: false,
	        FILE_SUFFIX: '.html',
	        HAS_SOURCE:  true
	      };
	    </script>

		<script>
		  (function() {
		    var cx = '006559439261123061640:rgnmeebflcy';
		    var gcse = document.createElement('script');
		    gcse.type = 'text/javascript';
		    gcse.async = true;
		    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
		    var s = document.getElementsByTagName('script')[0];
		    s.parentNode.insertBefore(gcse, s);
		  })();
		</script>

		<script>
		  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
		  ga('create', 'UA-54984338-1', 'auto');
		  ga('send', 'pageview');
		</script>

    </body>
</html>